# 18. 웹 호스팅

컨텐츠 리소스를 저장, 중개, 관리하는 일 = 웹 호스팅

## 18.1 호스팅 서비스

웹이 대중화 되면서 웹 호스팅 서비스를 전문적으로 하는 업체 등장, 물리적인 장비 공간부터 가상 공간까지 다양한 서비스들이 있음

### 18.1.1 간단한 예 : 전용 호스팅

A가 운영하는 웹사이트를 B의 ISP(internet service provider)가 제공하는 전용 웹 호스팅 서비스에 가입하여 B의 ISP를 구매해 유지보수 하고 있는 전용 웹 서버를 임대함.
이때 B의 ISP는 대량으로 서버 장비를 구매 가능, 안정적이고 검증된 비용이 저렴한 장비를 선택 가능함.

## 8.2 가상 호스팅

가상 호스팅은 가상의 서버(컴퓨터)를 여러 고객에게 필요한 부분만큼 나눠 공유하여 저렴한 웹 호스팅 서비스를 제공하는 것! 공유 호스팅이라고도 함.

- 가상 호스팅은 비용, 공간, 관리에 이점이있어 가상호스팅을 제공하는 업체는 한 서버에 수십, 수백, 수천 개의 웹 사이트를 호스팅하려 함. 이때, pc한대에 수십, 수백, 수천개의 웹 사이트를 호스팅 하는 것이 아니라 호스팅 업자는 복제 서버 더미 (서버 팜)를 만들고 서버 팜에 부하를 분산할 수 있음. 팜에 있는 각 서버는 다른 서버를 복제한 것이고 수 많은 가상 웹 사이트를 호스팅 하고 있기 때문에 관리자는 훨씬 편해짐.

### 8.2.1 호스트 정보가 없는 가상 서버 요청

HTTP/1.0 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별하는 기능을 제공하지 않음. 서버가 여러 개의 사이트를 가상 호스팅하고 있으면 사용자가 어떤 가상 웹 사이트로 접근하려고 하는 것인지 아는데 필요한 정보가 충분하지 않음. 두 요청(서로 다른 웹사이트의 요청)이 완전히 다른 문서를 요청을 하더라도, 요청 자체는 똑같이 생겼는데 웹 사이트 호스트 정보가 요청에서 제거 된다는 점이 문제임. 이때 HTTP대시 서버(리버스 프락시)와 인터셉트 프락시 또한 어떤 사이트를 요청하는지에 관한 정보가 필요함.

### 18.2.2 가상 호스팅 동작하게 하기

초기 명세는 가상 호스팅을 고려하지 않았기 때문에 웹 호스팅 업자는 공용 가상 호스팅을 지원하는 데 필요한 차선책과 컨벤션을 개발해야 했음. HTTP요청 메시지에 경로 컴포넌트만 보내는 것이 아니라 완전한 URL도 포함 해 보내게 해야 해결이 된다는 것이 문제였음.
HTTP/1.1을 지원하는 서버는 HTTP 요청 메시지에 있는 전체 URL을 처리할 수 있어야함. 기존에 있던 모든 애플리케이션이 이 명세에 맞추어 업그레이드하기까지는 오랜 시간이 걸림. 이 문제를 새결하기 위해 나타난 기술

1. URL 경로를 통한 가상 호스팅
2. 포트번호를 통한 가상 호스팅
3. IP주소를 통한 가상 호스팅
4. Host 헤더를 통한 가상 호스팅

### 18.2.3 HTTP/1.1 Host 헤더

클라이언트가 HTTP/1.1과 호환되지 않더라도 Host헤더는 구현됨.

> 문법과 사용방법, 규칙

```
Host = "Host" ":"호스트[ ":"포트 ]
```

- Host헤더에 포트가 기술되어 있지 않으면, 해당 스킨의 기본 포트를 사용함.
- URL에 IP 주소가 있으면, Host 헤더는 같은 주소를 포함해야 함.
- URL에 호스트 명이 기술되어 있으면, Host 헤더는 같은 호스트 명을 포함해야함
- URL에 호스트 명이 기술되어 있으면, Host 헤더는 URL의 호스트 명이 가리키는 IP 주소를 포함해서는 안됨. 여러 개의 가상 사이트를 한 개의 IP주소에 연결한 가상 호스트 서버에서 문제가 될 수 있기 때문.
- 클라이언트가 특정 프락시 서버를 사용한다면, Host 헤더에 프락시 서버가 아닌 원 서버의 호스트 명과 포트를 기술해야 함. 과거에는 여러 웹 클라이언트가 프락시 설정이 활성화되어 있을 때 전송하는 Host 헤더에 프락시의 호스트 명을 넣는 버그가 있음. 이 문제가 프락시와 원 서버를 오동작시키는 원인이 됨.
- 웹 클라이언트는 모든 요청 메시지에 Host 헤더를 기술해야함.
- HTTP/1.1 웹 서버는 Host 헤더 필드가 없는 HTTP/1.1 요청 메시지를 받으면 400 상태 코드로 응답해야 함.

## 18.3 안정적인 웹 사이트 만들기

웹 사이트의 서버다운 ,트래픽 폭증, 네트워크 장애나 손실과 같은 문제를 예측하고 대응하는 방법.

### 18.3.1 미러링 된 서버 팜

서버 팜 = 서로 대신할 수 있고 식별할 수 있게 설정됨 웹 서버들의 집함.

- 원본 서버는 마스터 원 서버, 미러링 된 서버는 복제된 원 서버라 부름
- 미러링 된 웹 서버에 다른 위치에 있는 콘텐츠와 정확히 같은 복제본이 있음.
- 한 곳에 문제가 생기면 다른 서버에서 대신 데이터를 전달함.

> 전달 방법

- HTTP 리다이렉션
- DNS 리다리렉션

### 18.3.2 콘텐츠 분산 네트워크

특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크

- 서버, 대리 서버, 프락시 서버

### 18.3.3 CDN의 대리 캐시

복제 원 서버를 대신해 사용될 수 있음. 리버스 프락시라고도 불림. 미러링 된 서버와 차이는 보통 수요에 따라서 동작함. 대리 서버는 원 서버 전체 콘텐츠를 복사하지 않고 클라이언트가 요청하는 콘텐츠만 저장함.

### 18.3.4 CDN의 프락시 캐시

대리 서버와는 다르게 전통적인 프락시 캐시는 어떤 웹 서버 요청이든지 다 받을 수 있음. 대리 서버를 사용하면 프락시 캐시의 콘텐츠는 요청이 있을 때만 저장될 것이고 원본 서버 콘첸츠를 정확히 복제한다는 보장이 없음. 어떤 프락시는 요청을 많이 받는 콘텐츠를 미리 로딩하기도 함.

- 가로 채기 성정은 클라이언트와 서버 사이의 모든 HTTP요청이 물리적으로 캐시를 거치게 네트워크 설정을 할 수 있는지에 따라 달라짐. 콘텐츠는 받는 요청에 따라 캐시에 분산됨.

## 18.4 웹 사이트 빠르게 만들기

웹 사이트 속도를 높이는 또 다른 방법은 콘텐츠를 인코딩 하는 것. 15장 참고

## 18.5 추가 정보
