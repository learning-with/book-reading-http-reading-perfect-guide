# 18. 웹 호스팅
콘텐츠 리소스를 저장, 중개, 관리하는 일

콘텐츠를 저장해서 제공하고 관련 로그에 접근하거나 그것을 관리하는 데 서버가 필요하며, 관리하기 어렵다면 호스팅 서비스나 호스팅 업체 필요
## 18.1 호스팅 서비스
월드 와이드 웹 초기에는 각 회사가 자체 컴퓨터 하드웨어를 구매하고 자체 컴퓨터 망을 구축하여 자체 네트워크 연결을 확보하고 자체 웹 서버 소프트웨어를 관리했음

웹이 빠르게 대세가 되었으나 냉난방 장치가 있는 서버실이나 도메인 이름을 등록하고 네트워크 대역폭을 구매할 기술과 시간을 가진 사람이 드물었기 때문에, 시간을 절약하기 위해 전문적으로 관리하는 웹 호스팅 서비스를 제공하는 여러 신사업이 만들어짐
### 18.1.1 간단한 예: 전용 호스팅
## 18.2 가상 호스팅
많은 웹 호스팅 업자는 컴퓨터 한 대를 여러 고객이 공유하게 해서 저렴한 웹 호스팅 서비스인 공유 호스팅 혹은 가상 호스팅을 제공

호스팅 업자는 복제 서버 더미(서버 팜)를 만들고 서버 팜에 부하를 분산할 수 있음

팜에 있는 각 서버는 다른 서버를 복제한 것이며, 이를 통해 수많은 가상 웹 서비스를 호스팅할 수 있음
### 18.2.1 호스트 정보가 없는 가상 서버 요청
HTTP/1.1 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 잇는지 식별하는 기능을 제공하지 않음

사용자가 어떤 웹 사이트로 접근하려고 하는지 아는데 필요한 정보가 충분하지 않음
### 18.2.2 가상 호스팅 동작하게 하기
초기 명세는 가상 호스팅을 고려하지 않았고, 모든 HTTP 요청 메시지에 경로 컴포넌트만 보내는 것이 아니라 완전한 URI도 포함해 해결

#### URL 경로를 통한 가상 호스팅
서버가 어떤 사이트를 요청하는 것인지 알 수 있게 URL에 특별한 경로 컴포넌트를 추가
#### 포트번호를 통한 가상 호스팅
각 사이트에 다른 포트번호를 할당하여, 분리된 웹 서버의 인스턴스가 요청을 처리
#### IP 주소를 통한 가상 호스팅
각 가상 사이트에 별도의 IP 주소를 할당하고 모든 IP 주소를 장비 하나에 연결한 후, 웹 서버는 IP 주소로 사이트 이름을 식별
#### Host 헤더를 통한 가상 호스팅
웹 호스팅 업자들의 요청으로 HTTP/1.0의 개선 버전과 HTTP/1.1의 공식 버전은 사이트 이름을 알려주는 Host 요청 헤더를 정의
### 18.2.3 HTTP/1.1 Host 헤더
#### 문법과 사용 방법
- Host 헤더에 포트가 기술되어 있지 않으면, 해당 스킴의 기본 포트를 사용한다.
- URL에 IP 주소가 있으면, Host 헤더는 같은 주소를 포함해야 한다.
- URL에 호스트 명이 기술되어 있으면, Host 헤더는 같은 호스트 명을 포함해야 한다.
- URL에 호스트 명이 기술되어 있으면, Host 헤더는 URL의 호스트 명이 가리키는 IP 주소를 포함해서는 안된다. 그 이유는, 여러 개의 가상 사이트를 한 개의 IP 주소에 연결한 가상 호스트 서버에서 문제가 될 수 있기 때문이다.
- 클라이언트가 특정 프락시 서버를 사용한다면, Host 헤더에 프락시 서버가 아닌 원 서버의 호스트 명과 포트를 기술해야 한다. 과거에는 여러 웹 클라이언트가 프락시 설정이 활성화되어 있을 때 전송하는 Host 헤더에 프락시의 호스트 명을 넣는 버그가 있었다. 이 문제는 프락시와 원 서버를 오동작시키는 원인이 된다.
- 웹 클라이언트는 모든 요청 메시지에 Host 헤더를 기술해야 한다.
- 웹 프락시는 요청을 전달하기 전에 요청 메시지에 Host 헤더를 추가해야 한다.
- HTTP/1.1 웹 서버는 Host 헤더 필드가 없는 HTTP/1.1 요청 메시지를 받으면 400 상태 코드로 응답해야 한다.
#### Host 헤더의 누락
#### Host 헤더 해석하기
1. HTTP 요청 메시지에 전체 URL이 기술되어 있으면, Host 헤더에 있는 값은 무시하고 URL을 사용한다.
2. HTTP 요청 메시지에 있는 URL에 호스트 명이 기술되어 있지 않고 요청에 Host 헤더가 있으면, 호스트 명과 포트를 Host 헤더에서 가져온다.
3. 1단계나 2단계에서 호스트를 결정할 수 없으면 클라이언트에 400 Bad Request 응답을 반환한다.
#### Host 헤더와 프락시
## 18.3 안정적인 웹 사이트 만들기
웹 사이트에 장애가 생기는 몇 가지 상황
- 서버 다운
- 갑작스러운 트래픽 폭증
- 네트워크 장애나 손실
### 18.3.1 미러링 된 서버 팜
서버팜은 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합

서버 팜의 서버에 있는 콘텐츠들을 한 곳에 문제가 생기면 다른 한 곳에서 대신 전달할 수 있게 미러링 가능

마스터 서버는 클라이언트에게 콘텐츠를 제공하면서 복제 서버들에게 콘텐츠를 퍼트리는 일을 하며, 클라이언트의 요청이 특정 서버로 가는 방법은 두 가지

- HTTP 리다이렉션: 콘텐츠에 대한 URL은 마스터 서버의 IP를 가리키고, 마스터 서버는 요청을 받는 즉시 복제 서버로 리다이렉트
- DNS 리다이렉션: 콘텐츠의 URL은 네 개의 IP 주소를 가리킬 수 있고, DNS 서버는 클라이언트에게 전송할 IP 주소를 선택 가능
### 18.3.2 콘텐츠 분산 네트워크(CDN)
특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크

네트워크의 노드는 서버, 대리 서버, 혹은 프락시 서버가 될 수 있음
### 18.3.3 CDN의 대리 캐시
대리 캐시는 복제 원 서버를 대신해 사용 가능

리버스 프락시라고도 불리는 대리 서버는 미러링된 웹 서버처럼 특정 원 서버 집합을 대신해 콘텐츠에 대한 요청을 받음

대리 서버는 보통 수요에 따라서 동작하여 원 서버의 전체 콘텐츠를 복사하지 않고 클라이언트가 요청하는 콘텐츠만 저장함

대리 서버의 캐시에 콘텐츠가 분산되는 방식은 그들이 받는 요청에 따라 달라짐
### 18.3.4 CDN의 프락시 캐시
대리 서버를 사용하면, 프락시 캐시의 콘텐츠는 요청이 있을 때만 저장될 것이고 원본 서버 콘텐츠를 정확히 복제한다는 보장이 없음
## 18.4 웹 사이트 빠르게 만들기
리소스의 로딩 속도를 좌우하는 핵심 요소는, 어떻게 요청과 응답이 클라이언트와 서버 사이에서 연결을 맺고 인터넷을 가로질러 데이터를 전송하는지임
## 18.5 추가 정보
