# 11. 클라이언트 식별과 쿠키
## 11.1 개별 접촉
HTTP는 익명으로 사용하며 상태가 없고 요청과 응답으로 통신하는 프로토콜

웹 서버는 요청을 보낸 사용자를 식별하거나 방문자가 보낸 연속적인 요청을 추적하기 위해 약간의 정보를 이용할 수 있음

##### 개별 인사
##### 사용자 맞춤 추천
##### 저장된 사용자 정보
##### 세션 추적
HTTP가 사용자를 식별하는 데 사용하는 기술들

- 사용자 식별 관련 정보를 전달하는 HTTP 헤더들
- 클라이언트 IP 주소 추적으로 알아낸 IP 주소로 사용자를 식별
- 사용자 로그인 인증을 통한 사용자 식별
- URL에 식별자를 포함하는 기술인 뚱뚱한 URL
- 식별 정보를 지속해서 유지하는 강력하면서도 효율적인 기술인 쿠키

## 11.2 HTTP 헤더
|헤더 이름 | 헤더 타입 | 설명 |
|:--:|:--:|:--:|
|Form|요청|사용자의 이메일 주소|
|User-Agent|요청|사용자의 브라우저|
|Referer|요청|사용자가 현재 링크를 타고 온 근원 페이지|
|Authorization|요청|사용자 이름과 비밀번호|
|Client-ip|확장(요청)|클라이언트의 IP 주소|
|X-Forwarded-For|확장(요청)|클라이언트의 IP 주소|
|Cookie|확장(요청)|서버가 생성한 ID 라벨|

## 11.3 클라이언트 IP 주소
클라이언트의 IP 주소는 보통 HTTP 헤더에 없지만 웹 서버는 HTTP 요청을 보내는 반대쪽 TCP 커넥션의 IP 주소를 알아낼 수 있음
- 클라이언트 IP 주소는 사용자가 아닌, 사용하는 컴퓨터를 가리킨다. 만약 여러 사용자가 같은 컴퓨터를 사용한다면 그들을 식별할 수 없을 것이다.
- 많은 인터넷 서비스 제공자(ISP)는 사용자가 로그인하면 동적으로 IP 주소를 할당한다. 로그인한 시간에 따라, 사용자는 매번 다른 주소를 받으므로, 웹 서버는 사용자를 IP 주소로 식별할 수 없다.
- 보안을 강화하고 부족한 주소들을 관리하려고 많은 사용자가 네트워크 주소 변환(Network Address Translation, NAT) 방화벽을 통해 인터넷을 사용한다. 이 NAT 장비들은 클라이언트의 실제 IP 주소를 방화벽 뒤로 숨기고, 클라이언트의 실제 IP 주소를 내부에서 사용하는 하나의 방화벽 IP 주소(그리고 다른 포트번호)로 변환된다.
- 보통, HTTP 프락시와 게이트웨이는 원 서버에 새로운 TCP 연결을 한다. 웹 서버는 클라이언트의 IP 주소 대신 프락시 서버의 IP 주소를 본다. 일부 프락시는 원본 IP 주소를 보존하려고 Client-ip나 X-Forwarded-For HTTP 같은 확장 헤더를 추가하여 이 문제를 해결하려 했다. 하지만 모든 프락시가 이런 식으로 동작하진 않는다.

## 11.4 사용자 로그인
IP 주소로 사용자를 식별하려는 수동적인 방식보다, 웹 서버는 사용자 이름과 비밀번호로 인증(로그인)할 것을 요구해서 사용자에게 명시적으로 식별 요청을 할 수 있음

웹 사이트 로그인이 더 쉽도록 HTTP는 WWW-Authenticate와 Authorization 헤더를 사용해 웹 사이트에 사용자 이름을 전달하는 자체적인 체계를 가지고 있음

- 브라우저는 www.joes-hadware.com 사이트로 요청한다.
- 사이트는 사용자의 식별정보를 알지 못하므로, 서버는 401 Login Required HTTP 응답 코드와 WWW-Authenticate 헤더를 반환하여 로그인하라고 요청한다. 이는 브라우저에 로그인 대화 상자를 띄우게 한다.
- 사용자가 사용자 이름과 비밀번호를 입력하고 브라우저는 기존 요청을 다시 보내서 사용자 식별을 시도한다.
- 이 시점 이후의 요청에 대해서, 브라우저는 서버로부터 사용자 식별 정보를 요청받으면, 서버에서 오는 요청에 대해 자동으로 사용자 이름과 비밀번호를 포함하며, 심지어 요청하지 않았을 때에도 전달한다. 이는 사이트에 한 번만 로그인하면, 브라우저는 요청마다 해당 사용자의 식별정보 토큰을 Authorization 헤더에 담아 서버로 전송해서, 한 세션이 진행되는 내내 그 사용자에 대한 식별을 유지한다.

## 11.5 뚱뚱한 URL
URL은 URL 경로의 처음이나 끝에 어떤 상태 정보를 추가해 확장하며, 사용자가 그 사이트를 돌아다니면 웹 서버는 URL에 있는 상태 정보를 유지하는 하이퍼링크를 동적으로 생성함

사용자의 상태 정보를 포함하고 있는 URL을 뚱뚱한 URL이라고 함

##### 못생긴 URL
##### 공유하지 못하는 URL
##### 캐시를 사용할 수 없음
##### 서버 부하 가중
##### 이탈
##### 세션 간 지속성의 부재

## 11.6 쿠키
### 11.6.1 쿠키의 타입
#### 세션 쿠키session cookie
사용자가 사이트를 탐색할 때, 관련한 설정과 선호 사항들을 저장하는 임시 쿠키

세션 쿠키는 사용자가 브라우저를 닫으면 삭제됨
#### 지속 쿠키persistent cookie
사용자가 주기적으로 방문하는 사이트에 대한 설정 정보나 로그인 이름을 유지하려고 사용

디스크에 저장되어 브라우저를 닫거나 컴퓨터를 재시작하더라도 남아있음

쿠키는 Discard 파라미터가 설정되어 있거나, 파기되기까지 남은 시간을 가리키는 Expires 혹은 Max-Age 파라미터가 없으면 세션 쿠키가 됨

### 11.6.2 쿠키는 어떻게 동작하는가
### 11.6.3 쿠키 상자: 클라이언트 측 상태
### 11.6.4 사이트마다 각기 다른 쿠키들
### 11.6.5 쿠키 구성요소
### 11.6.6 Version 0(넷스케이프) 쿠키
### 11.6.7 Version 1 (RFC 2965) 쿠키
### 11.6.8 쿠키와 세션 추적
### 11.6.9 쿠키와 캐싱
### 11.6.10 쿠키, 보안 그리고 개인정보
