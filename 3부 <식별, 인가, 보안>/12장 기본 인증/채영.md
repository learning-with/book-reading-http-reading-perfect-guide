# 12 기본인증

## 12.1 인증

### 12.1.1 HTTP의 인증요구/응답 프레임워크

웹 애플리케이션이 HTTP 요청 메시지를 받으면, 서버는 요청을 처리하는 대신, 현재 사용자가 누구인지를 알 수 있게 비밀번호 같이 개인 정보를 요구하는 인증 요구로 응답할 수 있음.
인증 정보가 맞지 않으면 서버는 클라이언트에게 다시 인증요구를 보내거나 에러를 출력함.

### 12.1.2 인증 프로토콜과 헤더

HTTP는 필요에 따라 고쳐쓸 수 있는 제어 헤더를 통해, 다른 인증 프로토콜에 맞추어 확장할 수 있는 프레임워크를 제공함. HTTP에는 기본 인증과 다이제스트 인증 두 가지 공식적인 인증 프로토콜이 있음.

| 단계      |        헤더         | 설명                                                                                                                                                                                                                       | 메서드/상태      |
| --------- | :-----------------: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------- |
| 요청      |                     | 첫 번째 요청에는 인증 정보가 없음                                                                                                                                                                                          | GET              |
| 인증 요구 |  WWW-Authenticate   | 서버는 사용자에게 사용자 이름과 비밀번호를 제공하라는 지시의 의미로 401 상태 정보와 함께 요청을 반려함. 서버에는 각각 다른 비밀번호가 있는 영역들이 있을 것이므로, 서버는 WWW-Authenticate 헤더에 해당 영역을 설명해 놓음. | 401 Unauthorized |
| 인증      |    Authorization    | 클라이언트는 요청을 다시 보내는데, 이번에는 인증 알고리즘과 사용자 이름과 비밀번호를 기술한 Authoriza-tion 헤더를 함께 보냄.                                                                                               |
| 성공      | Authentication-Info | 인증 정보가 정확하면, 서버는 문서와 함께 응답함. 어떤 인증 알고리즘은 선택적인 헤더인 Authentication-info에 인증 세션에 관한 추가 정보를 기술해서 응답하기도함.                                                            | 200 OK           |

### 12.1.3 보안 영역

HTTP가 리소스마다 다른 접근 조건을 어떻게 다루는가?

- 웹 서버는 기밀문서를 보안 영역(realm) 그룹으로 나눔. 보안 영역은 저마다 다른 사용자 권한을 요구함.

```
HTTP/1.0 401 Unauthorized
WWW-Authenticate: Basic realm="Corporate Financials"
```

`"Corporate Financials"`는 사용자가 권한의 범위를 이해하는데 도움이 되어야함. 서버의 호스트명을 넣는 것도 유용할 수 있음.

## 12.2 기본 인증

클라이언트가 접근하려고 했던 보안 영역을 WWW-Authenticate에 기술해서 응답하여 인증요구를 시작함. 인증 정보를 포함하여 요청하라는 응답을 받은 브라우저는 사용자에게 계정과 비밀번호를 입력할 수 있는 대화상자를 염. 브라우저는 사용자가 입력한 사용자 이름과 비밀번호를 Authorization 요청 헤더 안에 암호화해서 서버로 다시 보냄.

### 12.2.1 기본 인증의 예

| 인증요구/응답                | 헤더 문법과 설명                                                                                                                                                                                                                                             |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 인증요구(서버 -> 클라이언트) | 각 사이트는 보안 영역마다 다른 비밀번호가 있을 것임. realm은 요청 받은 문서 집합의 이름을 따옴표로 감싼 것으로, 사용자는 이 정보를 보고 어떤 비밀번호를 사용해야 하는지 알 수 있음 <br> `WWW-Authenticate: Basic realm=따옴표로 감싼 문서 집합 정보`         |
| 응답(클라이언트 -> 서버)     | 사용자 이름과 비밀번호는 콜론으로 잇고, base-64로 인코딩해서 사용자 이름과 비밀번호에 쉽게 국제문자를 포함할 수 있게 하고, 네트워크 트래픽에 사용자 이름과 비밀번호가 노출되지 않게 함. <br>`Authorization: Basic base-64로 인코딩한 사용자 이름과 비밀번호` |

### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

HTTP 기본 인증은 사용자 이름과 비밀번호를 콜론으로 합치고 base-64인코딩 메서드를 이용해 인코딩함.

```
id : brian-totty
password: Ow!

`brian-totty:Ow!`형태로 이어서 base-64로 인코딩함
YnJpYW...
```

Base-64 인코딩은 바이너리, 텍스트, 국제 문자 데이터(어떤 시스템에서는 문제를 일으킬 수 있는 )문자열 받아서 전송할 수 있게, 그 문자열을 전송 가능한 문자인 알파벳으로 변환하기 위해 발명됨.
전송 중에 원본 문자열이 변질될 걱정없이 원격에서 디코딩 할 수 있음.

### 12.2.3 프락시 인증

중개 프락시 서버를 통해 인증 가능. 아래는 웹 서버와 프락시 인증에서 쓰이는 상태 코드와 헤더들의 대조표.
|웹|프락시 서버|
|---|------|
|비인증 상태 코드 : 401| 비인증 상태 코드 : 407|
|WWW-Authenticate|Proxy-Authenticate|
|Authorization| Proxy-Authenticate|
|Authorization-Info|Proxy-Authenticate-Info|

## 12.3 기본 인증의 보안 결함

- 기본 인증은 사용자 이름과 비밀번호를 쉽게 디코딩 할 수 있는 형식으로 네트워크에 전송. 사실상 비밀번호 그대로 보내는 것과 다름없음. 보안 강화시 다이제스트 인증 프로토콜 사용하기
- 복잡하게 재전송 공격을 막기 어려움
- 사용자는 많은 사이트에 같은 아이디와 비밀번호를 사용함. 보안이 약한 사이트에서 정보를 얻어 문자열 그대로 캡쳐하여 중요한 사이트에 사용할 수도 있음.
- 기본 인증은 가짜 서버에 취약함.

> 기본 인증은 사용자 이름과 비밀번호를 악의적인 개인들에게 숨기려고 암호화된 데이터 전송임. 보다 강력한 보안 관련 속성은 다이제스트 인증임.

## 12.4 추가 정보
