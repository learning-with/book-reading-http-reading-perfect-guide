# 3장 HTTP 메세지

## 3.1 메세지의 흐름

HTTP 메세지: HTTP 애플리케이션 간에 주고받은 데이터의 블록들

- 텍스트 메타 정보: 메세지 내용과 의미 설명
- 인바운드, 아웃바운드, 업스트림, 다운스트림

### 3.1.1 메세지는 원 서버 방향을 인바운드로 하여 송신된다

인바운드 : 클라이언트 -> 서버

아웃바운드: 서버 -> 클라이언트

### 3.1.2 다운스트림으로 흐르는 메시지

모든 메시지는 다운스트림으로 흐른다.

## 3.2 aptlwldml rkr qnqns

HTTP 메시지는 데이터의 구조화된 블록

- 시작줄 : 어떤 메세지인지 서술
- 헤더 : 속성
- 본문 : 데이터 , 아예 없을 수도.
  시작줄과 헤더는 줄단위로 분리된 아스키 문자열

### 3.2.1 메시지 문법

## 요청메시지

<메서드><요청URL><버전> -> 시작줄, 요청줄

<헤더>

<엔터티 본문>

- 메서드 : 서버라 리소스에 대해 수행해주길 바라는 동작
- 요청URL : 요청 대상이 되는 리소스를 지칭하는 완전한 URL 또는 URL의 경로 구성요소
- 버전 : HTTP 버전 HTTP<메이저>.<마이너>

## 응답메시지

<버전><상태코드><사유구절> -> 시작줄, 응답줄

<헤더>

<엔터티 본문>

- 상태코드 : 요청 중에 뭉슨 일이 일어났는지 설명하는 세자리의 수
- 사유구절 : 상태코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
- 헤더들 : 이름, 콜론, 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들.
- 엔터티 본문: 임의의 데이터 블록. 보든 메시지가 엔터티 본문을 갖는건 아님

헤더나 엔터티 본문이 없더라고 HTTP 헤더의 집합은 항상 빈줄로 끝나야함

### 3.2.2 시작줄

시작줄은 무슨 일이 일어났는지 말해준다.

#### 요청줄

---

<메서드><요청URL><버전>

#### 응답줄

---

<버전><상태코드><사유구절>

## 3.3 메서드

| 메서드  | 설명                                                    | 메시지 본문이 있는가? |
| ------- | ------------------------------------------------------- | --------------------- |
| GET     | 서버에서 어떤 문서를 가져온다                           | 없음                  |
| HEAD    | 서버에서 어떤 문서에 대해 헤더만 가져온다.              | 없음                  |
| POST    | 서버가 처리해야 할 데이터를 보낸다.                     | 있음                  |
| PUT     | 서버에 요청 메세지의 본문을 저장한다.                   | 있음                  |
| TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | 없음                  |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | 없음                  |
| DELETE  | 서버에서 문서를 제거한다.                               | 없음                  |

서버가 모든 메서드를 구현하지는 않는다.

### 3.3.1 안전한 메서드

= 멱등한 메서드. HTTP 요청의 결과로 인해 서버에서 일어나는 것이 없는 것.
안전한 메서드라고 해서 서버에 작용을 유발하지 않는다는 보장은 없고 개발자의 영역.

안전한 메서드의 목적: 서버에 어떤 영향을 줄 수 있는 안전하지 않는은 메서드가 사용될 때 사용자들에게 그 사실을 알려주는 HTTP 애플리케이션을 만들 수 있도로 하는 것.

### 3.3.2 GET

서버에게 리소스를 달라고 요청.

### 3.3.3 HEAD

GET처럼 행동. BUT 서버는 응답으로 헤더만 돌려준다.

-> 리소스를 가져오지 않고 타입을 알 수 있다.

-> 상태코드를 통해 개체가 존재하는 확인할 수 있다.

-> 리소스가 변경되었는지 확인할 수 있다.

### 3.3.4 PUT

서버에 문서를 쓴다. 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새문서를 만들거나 이미 URL이 존재한다면 본문을 사용해서 교체한다.

### 3.3.5 POST

서버에 입력 데이터를 전송하기 위해 설계.HTML폼을 지원하기 위해서 사용. 폼에 담긴 데이터를 서버로 전송

### 3.3.6 TRACE

진단을 위해 사용된다. HTTP의 TRACE 메서드는 중간 프록시 또는 서버를 포함하여 클라이언트와 서버 간의 통신 문제를 디버깅하거나 해결하기 위한 진단 목적

### 3.3.7 OPTIONS

서버에게 여러 가지 종류의 지원범위에 대해 물어본다. 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있음.

### 3.3.8 DELETE

서버에게 요청URL로 지정한 리소스를 삭제할 것을 요청.
삭제가 된다는 걸 보장하진 X. HTTP 명세는 서버가 클라이언트에게 알리지 않고 요청을 무시하는 것을 허용하기 때문.

### 3.3.9 확장 메서드

HTTP 메서드는 확장해도 문제가 없도록 설계되어있음.

## 3.4 상태코드

- 메서드 : 서버에게 무엇을 해야하는지 말해줌
- 상태코드 : 클라이언트에게 무엇이 일어났는지 말해줌. 응답메세지의 시작줄에 담겨 반환됨.

### 3.4.1 100-199: 정보성 상태 코드

HTTP/1.1에서 도입.

- 100 Continue : 최적화를 위한 것으로 클라이언트가 서버로 엔터티 본문을 전송하려할 때 서버가 이를 받아들일 것인지 확인하려고 사용.

### 3.4.2 200-299: 성공 상태 코드

성공을 의미하는 상태 코드

| 상태 코드 | 사유 구절                     | 의미                                                                                                                                                                                                              |
| --------- | ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 200       | OK                            | 요청 정상, 엔티티 본문에 요청 리소스 포함                                                                                                                                                                         |
| 201       | Created                       | 생성 요청(ex.PUT)에 대해 리소스를 생성함 헤더에는 생성된 리소스의 구체적인 참조(Location 헤더) 포함 엔티티 본문에는 리소스를 참조할 수 있는 여러 URL 포함                                                         |
| 202       | Accepted                      | 요청은 정상이나 서버는 어떤 동작도 수행하지 않음 (요청을 다른 프로세스에서 처리하거나, 서버가 다른 일을 하고 있기 때문) 엔티티 본문에 요청에 대한 상태와 가급적이면 언제 완료될 수 있는지에 대한 추정 포함해야 함 |
| 203       | Non-Authoritative Information | 엔티티 헤더에 들어있는 정보가 원래 서버가 아닌 중개자의 리소스 사본에서 옴. 중개자로부 리소스 사본을 받았지만, 리소스 헤더가 서버와 일치하지 않는 경우                                                            |
| 204       | No Content                    | 본문으로 보내줄 것은 없지만, 헤더와 상태줄이 의미 있는 경우 웹브라우저를 새 문서로 이동시키지 않고 갱신 (ex. 폼 리프레시)                                                                                         |
| 205       | Reset Conent                  | 브라우저에게 현재 페이지에 있는 모든 HTML 폼 값을 비우라고 말함                                                                                                                                                   |
| 206       | Partial Content               | 부분 혹은 범위 요청이 성공 Content-Range, Date 헤더를 반드시 포함 Etag/Content-Location 헤더 중 하나도 반드시 포함                                                                                                |

### 3.4.3 300-399:리다이렉션 상태코드

리소스에 대해 다른 위치 사용하라고 말해줌.
리소스에 어디서 찾을 수 있는지 리다이렉션 상태코드와 location헤더를 보낼 수 있다.
복사본이 유효한지 확인하기 위해서도 사용가능.

| 상태 코드 | 사유 구절          | 의미                                                                                                                  |
| --------- | ------------------ | --------------------------------------------------------------------------------------------------------------------- |
| 300       | Multiple Choices   | 동시에 여러 리소스를 가리키는 URL을 요청한 경우, 리소스 목록과 함께 반환함                                            |
| 301       | Moved Permanently  | 요청한 URL이 Location 헤더에 있는 URL로 옮겨짐                                                                        |
| 302       | Found              | 301과 같으나, 클라이언트는 Location 헤더의 URL을 임시로만 사용하고 이후에는 원래 URL을 사용해야 함                    |
| 303       | See Other          | 리소스를 Location 헤더에 있는 URL에서 가져와야 한다고 알려줌 POST에 대한 응답으로 클라이언트에게 리소스 위치를 알려줌 |
| 304       | Not Modified       | 클라이언트가 조건부 요청을 했을 때 리소스가 최근에 수정되지 않았음을 알려줌 응답은 엔티티 본문을 포함하지 않음        |
| 305       | Use Proxy          | 특정 리소스에 접근할 때 Location 헤더에 있는 프록시 URL을 통해야 함                                                   |
| 306       |                    | (현재는 사용되지 않는 코드)                                                                                           |
| 307       | Temporary Redirect | 301과 비슷하나, 클라이언트는 Location 헤더의 URL을 임시로만 사용하고 이후에는 원래 URL을 사용해야 함                  |

302, 303, 307

- 302 , HTTP/1.0 : 클라이언트 -> 서버 POST요청 보냄. 302코드 받으면 클라이언트는 location헤더에 들어있는 리다이렉트 URL을 GET으로 따라감.
- 303 , HTTP/1.1 : 클라이언트 -> 서버 POST요청 보냄. 303코드 받으면 클라이언트는 location헤더에 들어있는 리다이렉트 URL을 GET으로 따라감.
- 307 : POST -> POST요청

### 3.4.4 400-499:클라이언트 에러 상태코드

| 상태 코드 | 사유 구절                       | 의미                                                                                                                                             |
| --------- | ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| 400       | Bad Request                     | 클라이언트가 잘못된 요청을 보냄                                                                                                                  |
| 401       | Unauthorized                    | 클라이언트에게 인증 요구                                                                                                                         |
| 402       | Payment Required                | (현재 쓰이지 않음, 미래에 사용될 가능성)                                                                                                         |
| 403       | Forbidden                       | 요청이 서버에 의해 거부됨.엔티티 본문에 거부 이유를 설명할 수 있으나, 보통 거절의 이유를 숨기고 싶을 때 씀                                       |
| 404       | Not Found                       | 서버가 요청한 URL을 찾을 수 없음                                                                                                                 |
| 405       | Method Not Allowed              | 요청 URL에 대해 지하지 않는 메서드로 요청받음                                                                                                    |
| 406       | Not Acceptable                  | 주어진 URL에 대한 리소스 중 클라이언트가 요청한 규격에 맞는 것이 없음                                                                            |
| 407       | Proxy Authentication Required   | 401과 같으나 프락시 서버를 위해 사용함                                                                                                           |
| 408       | Request Timeout                 | 클라이언트의 요청을 완수하기에 시간이 너무 많이 걸림                                                                                             |
| 409       | Conflict                        | 요청이 충돌을 일으킬 염려가 있음 본문에 충돌에 대해 설명해야 함 ex. 서버에 있는 파일보다 오래된 파일을 PUT으로 업로드할 때 버전 제어 충돌이 발생 |
| 410       | Gone                            | 404와 비슷하나 리소스를 가지고 있었다 제거된 경우                                                                                                |
| 411       | Length Required                 | 요청에 Content-Length 헤더 요구                                                                                                                  |
| 412       | Precondition Failed             | 조건부 요청 중 하나가 실패                                                                                                                       |
| 413       | Request Entity Too Large        | 요청의 크기가 서버가 처리할 수 있는(or 처리하고자 하는) 한계를 넘음                                                                              |
| 414       | Request URI Too Long            | 요청 URL 길이가 서버가 처리할 수 있는(or 처리하고자 하는) 한계를 넘음                                                                            |
| 415       | Unsupported Media Type          | 서버가 지원하지 않는 유형의 엔티티 본문                                                                                                          |
| 416       | Requested Range Not Satisfiable | 요청한 리소스의 범위가 잘못됨                                                                                                                    |
| 417       | Expectation Failed              | Expect 요청 더에 있는 내용을 서버가 만족시킬 수 없음                                                                                             |

### 3.4.5 400-599:서버 에러 상태 코드

클라이언트에서 올바른 요청을 보냈지만 서버에서 에러 발생

| 상태 코드 | 사유 구절                  | 의미                                                                                                     |
| --------- | -------------------------- | -------------------------------------------------------------------------------------------------------- |
| 500       | Server Error               | 서버가 요청을 처리할 수 없음                                                                             |
| 501       | Not Implemented            | 클라이언트가 서버가 구현하지 않은 메서드로 요청을 함                                                     |
| 502       | Bad Gateway                | 프락시나 게이트웨이 등 다음 링크로부터 부정적인 응답을 받음                                              |
| 503       | Service Unavailabe         | 현재는 서버가 요청을 처리해줄 수 없지만 나중에는 가능함 Retry-After 헤더에 언제 가능한지를 포함하기도 함 |
| 504       | Gateway Timeout            | 408과 비슷하지만 게이트웨이나 프록시가 보내는 응답                                                       |
| 505       | HTTP Version Not Supported | 요청 프로토콜이 서버가 지원할 수 없는 버전임                                                             |
